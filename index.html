<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Reports</title>
<style>
  :root{
    --bg:#f7f8fb;
    --card:#ffffff;
    --muted:#6b7280;
    --accent:#0f766e;
  }
  body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);padding:20px;}
  .container{max-width:640px;margin:0 auto;}
  .card{background:var(--card);border-radius:14px;box-shadow:0 6px 24px rgba(16,24,40,0.06);padding:18px;}
  h1{margin:0 0 8px;font-size:20px;color:#0f172a;}
  p.lead{margin:0 0 14px;color:var(--muted);font-size:13px;}
  .field{margin-bottom:12px;}
  label{display:block;font-weight:600;margin-bottom:6px;font-size:13px;color:#0f172a;}
  input,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px;box-sizing:border-box;}
  input[type="file"]{font-size:13px;}
  .btn{padding:12px 14px;border-radius:10px;background:var(--accent);color:white;font-weight:700;border:0;font-size:15px;width:100%;cursor:pointer;}
  .btn:disabled{opacity:0.6;cursor:not-allowed;}
  .note{font-size:12px;color:var(--muted);margin-top:6px;}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:22px;background:#111;color:#fff;padding:12px 16px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.2);display:none;z-index:9999;}
</style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Daily Reports</h1>
      <p class="lead">Quickly log counts, topic, and a photo.</p>

      <form id="reportForm">
        <div class="field">
          <label for="absent">Absent Count</label>
          <input id="absent" name="absent" type="number" min="0" required />
        </div>
        <div class="field">
          <label for="bshift">B Shift Count</label>
          <input id="bshift" name="bshift" type="number" min="0" required />
        </div>
        <div class="field">
          <label for="gatepass">Gate Pass Process Count</label>
          <input id="gatepass" name="gatepass" type="number" min="0" required />
        </div>
        <div class="field">
          <label for="tbt">TBT Topic</label>
          <input id="tbt" name="tbt" type="text" maxlength="200" />
        </div>
        <div class="field">
          <label for="photo">Photo Upload (optional)</label>
          <input id="photo" name="photo" type="file" accept="image/*" />
          <div class="note">Photo will display directly in cell A18.</div>
        </div>
        <div class="field">
          <button class="btn" id="submitBtn" type="button">Save to Google Sheet</button>
        </div>
      </form>
    </div>
  </div>

  <div class="toast" id="toast"></div>
  <iframe id="hidden_iframe" name="hidden_iframe" style="display:none;"></iframe>

<script>
const APPS_SCRIPT_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwjbUZlsEf7a6FFYhXigEhbe5yuOMrqTyP27B2VJbO7ktcgoyLn4YnYmWOcZM9OF00h/exec";

const submitBtn = document.getElementById('submitBtn');
const form = document.getElementById('reportForm');
const toast = document.getElementById('toast');

function showToast(msg, ok=true){
  toast.style.display = 'block';
  toast.style.background = ok ? '#111' : '#b91c1c';
  toast.textContent = msg;
  setTimeout(()=>{ toast.style.display='none'; }, 3000);
}

window.addEventListener('message', function(ev){
  if (!ev.data) return;
  const payload = ev.data;
  submitBtn.disabled = false;
  submitBtn.textContent = 'Save to Google Sheet';

  if (payload.status === 'ok') {
    showToast(payload.message || 'Saved âœ…', true);
    form.reset();
  } else {
    showToast(payload.message || 'Error saving', false);
  }
}, false);

submitBtn.addEventListener('click', function(){
  if (submitBtn.disabled) return;

  const absent = document.getElementById('absent').value.trim();
  const bshift = document.getElementById('bshift').value.trim();
  const gatepass = document.getElementById('gatepass').value.trim();
  if (absent === '' || bshift === '' || gatepass === '') {
    showToast('Please fill all counts.', false);
    return;
  }
  if (APPS_SCRIPT_WEB_APP_URL.includes("YOUR_APPS_SCRIPT_WEB_APP_URL_HERE")) {
    showToast('Replace the Apps Script URL in code.', false);
    return;
  }

  submitBtn.disabled = true;
  submitBtn.textContent = 'Saving...';

  const tempForm = document.createElement('form');
  tempForm.style.display = 'none';
  tempForm.method = 'POST';
  tempForm.enctype = 'multipart/form-data';
  tempForm.action = APPS_SCRIPT_WEB_APP_URL;
  tempForm.target = 'hidden_iframe';

  const fields = {absent,bshift,gatepass,tbt:document.getElementById('tbt').value||''};
  Object.keys(fields).forEach(k=>{
    const inp = document.createElement('input');
    inp.type = 'hidden';
    inp.name = k;
    inp.value = fields[k];
    tempForm.appendChild(inp);
  });

  const fileInput = document.getElementById('photo');
  if (fileInput.files && fileInput.files.length > 0) {
    const file = fileInput.files[0];
    try {
      const dt = new DataTransfer();
      dt.items.add(file);
      const fileHolder = document.createElement('input');
      fileHolder.type = 'file';
      fileHolder.name = 'photo';
      fileHolder.files = dt.files;
      tempForm.appendChild(fileHolder);
    } catch (err) {
      tempForm.appendChild(fileInput);
    }
  }

  document.body.appendChild(tempForm);
  tempForm.submit();
  setTimeout(()=>{ try{document.body.removeChild(tempForm);}catch(e){} },1000);
  showToast('Saving... hang tight ðŸŒŸ');
});
</script>
</body>
</html>
