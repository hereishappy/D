<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDH Data Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.1/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.0.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
        }
        
        .dashboard-card {
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .dashboard-card:hover {
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .table-container {
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background-color: #1e40af;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        tbody tr:hover {
            background-color: #f1f5f9;
        }
        
        .attendance-card {
            min-width: 220px;
            transition: transform 0.3s ease;
        }
        
        .attendance-slider {
            display: flex;
            overflow-x: hidden;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background-color: #e2e8f0;
            overflow: hidden;
        }
        
        .progress-value {
            height: 100%;
            border-radius: 4px;
            background-color: #3b82f6;
        }
        
        .tab-active {
            border-bottom: 3px solid #1e40af;
            color: #1e40af;
            font-weight: 600;
        }
        
        .tab {
            cursor: pointer;
            padding: 10px 20px;
            transition: all 0.3s ease;
        }
        
        .tab:hover:not(.tab-active) {
            background-color: #f1f5f9;
            color: #1e40af;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-present {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .status-overtime {
            background-color: #ffedd5;
            color: #9a3412;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .animate-slide-in {
            animation: slideIn 0.5s forwards;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .refresh-timer {
            font-size: 0.8rem;
            color: #6b7280;
            margin-left: 8px;
        }
        
        .supervisor-image-container {
            width: 150px;
            height: 150px;
            margin: 0 auto;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid #3b82f6;
            position: relative;
        }
        
        .supervisor-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-upload-btn {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: #3b82f6;
            color: white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .file-input {
            display: none;
        }
        
        .supervisor-name-input {
            text-align: center;
            border: none;
            border-bottom: 2px solid #3b82f6;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e40af;
            background: transparent;
            width: 100%;
            padding: 4px;
            margin-top: 12px;
        }
        
        .supervisor-name-input:focus {
            outline: none;
            border-bottom: 2px solid #1e40af;
        }
        
        /* Card Carousel Styles */
        .card-carousel {
            position: relative;
            height: 400px;
            overflow: hidden;
        }
        
        .carousel-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transform: translateX(100%);
            transition: transform 0.8s ease, opacity 0.8s ease;
            padding: 1.5rem;
        }
        
        .carousel-slide.active {
            opacity: 1;
            transform: translateX(0);
        }
        
        .carousel-slide.prev {
            opacity: 0;
            transform: translateX(-100%);
        }
        
        .carousel-indicators {
            position: absolute;
            bottom: 10px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 8px;
            z-index: 10;
        }
        
        .carousel-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #cbd5e1;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }
        
        .carousel-indicator.active {
            background-color: #3b82f6;
            transform: scale(1.2);
        }
        
        .carousel-title {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background-color: #f8fafc;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 5;
        }
        
        .carousel-content {
            margin-top: 3.5rem;
            height: calc(100% - 3.5rem);
            overflow-y: auto;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        @keyframes rotateIn {
            from { transform: rotate(-5deg) scale(0.9); opacity: 0; }
            to { transform: rotate(0) scale(1); opacity: 1; }
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); opacity: 0.9; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes slideInLeft {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideInRight {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s forwards;
        }
        
        .animate-slide-up {
            animation: slideUp 0.5s forwards;
        }
        
        .animate-scale-in {
            animation: scaleIn 0.5s forwards;
        }
        
        .animate-rotate-in {
            animation: rotateIn 0.6s forwards;
        }
        
        .animate-bounce-in {
            animation: bounceIn 0.8s forwards;
        }
        
        .animate-slide-left {
            animation: slideInLeft 0.5s forwards;
        }
        
        .animate-slide-right {
            animation: slideInRight 0.5s forwards;
        }
        
        .manpower-ticker-item {
            animation: slideUp 0.5s forwards;
        }
        
        /* Vertical Manpower Ticker */
        .vertical-ticker-container {
            height: 300px;
            overflow: hidden;
            position: relative;
        }
        
        .vertical-ticker {
            position: absolute;
            width: 100%;
            transition: transform 0.5s ease;
        }
        
        .vertical-ticker-item {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            background-color: white;
            transition: all 0.3s ease;
        }
        
        .vertical-ticker-item:hover {
            background-color: #f1f5f9;
            transform: translateX(5px);
        }
        
        /* Summary Card Animations */
        .summary-card {
            transition: all 0.3s ease;
            transform-origin: center;
            overflow: hidden;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
        }
        
        .summary-card:hover .summary-icon {
            transform: scale(1.1) rotate(10deg);
        }
        
        .summary-icon {
            transition: all 0.3s ease;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .progress-value {
            position: relative;
            overflow: hidden;
        }
        
        .progress-value::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Floating animation for supervisor card */
        .float-animation {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        /* Achievement highlight animation */
        .achievement-item {
            transition: all 0.3s ease;
            position: relative;
            padding-left: 5px;
        }
        
        .achievement-item:hover {
            transform: translateX(5px);
            color: #1e40af;
        }
        
        .achievement-item::before {
            content: '';
            position: absolute;
            left: -5px;
            top: 50%;
            width: 0;
            height: 2px;
            background-color: #3b82f6;
            transition: width 0.3s ease;
            transform: translateY(-50%);
        }
        
        .achievement-item:hover::before {
            width: 5px;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loader"></div>
        <p class="mt-4 text-gray-700 font-medium">Loading data from Google Sheets...</p>
    </div>

    <div class="min-h-screen bg-gradient-to-b from-blue-50 to-white">
        <!-- Header -->
        <header class="bg-white shadow-md">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center">
                    <div class="bg-blue-700 text-white p-2 rounded-lg mr-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">CDH Data Dashboard</h1>
                        <p class="text-sm text-gray-500">Site Manager: Gurwinder Singh</p>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="mr-4">
                        <p class="text-sm text-gray-500">Last Updated</p>
                        <p class="text-md font-semibold text-gray-800" id="last-updated">Loading...</p>
                    </div>
                    <div class="flex items-center">
                        <button id="refresh-btn" class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-lg flex items-center transition-all duration-300 transform hover:scale-105">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                            Refresh Data
                        </button>
                        <span class="refresh-timer" id="refresh-timer">Auto-refresh in 60:00</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8">
            <!-- Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="dashboard-card bg-white p-6 summary-card" id="erection-card">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500 mb-1">Total Erection</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="total-erection">Loading...</h3>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full summary-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                            </svg>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs text-gray-500">Progress</span>
                            <span class="text-xs font-medium text-blue-700" id="erection-progress">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-value" id="erection-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card bg-white p-6 summary-card" id="dismantling-card">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500 mb-1">Total Dismantling</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="total-dismantling">Loading...</h3>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full summary-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                            </svg>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs text-gray-500">Progress</span>
                            <span class="text-xs font-medium text-green-700" id="dismantling-progress">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-value bg-green-500" id="dismantling-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card bg-white p-6 summary-card" id="manhours-card">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500 mb-1">Total Manhours</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="total-manhours">Loading...</h3>
                        </div>
                        <div class="bg-purple-100 p-3 rounded-full summary-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs text-gray-500">Utilization</span>
                            <span class="text-xs font-medium text-purple-700" id="manhours-utilization">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-value bg-purple-500" id="manhours-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card bg-white p-6 summary-card" id="productivity-card">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500 mb-1">Productivity</p>
                            <h3 class="text-2xl font-bold text-gray-800" id="productivity-value">Loading...</h3>
                        </div>
                        <div class="bg-amber-100 p-3 rounded-full summary-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                            </svg>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs text-gray-500">Target</span>
                            <span class="text-xs font-medium text-amber-700" id="productivity-target">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-value bg-amber-500" id="productivity-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Dashboard Cards -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <!-- Merged Card Carousel -->
                <div class="dashboard-card bg-white lg:col-span-2">
                    <div class="card-carousel" id="main-carousel">
                        <!-- Daily Progress Report Slide -->
                        <div class="carousel-slide" id="carousel-slide-1">
                            <div class="carousel-title">
                                <h3 class="text-lg font-semibold text-gray-800">Daily Progress Report</h3>
                                <a href="#dpr-content" class="text-sm text-blue-600 hover:underline">View All</a>
                            </div>
                            <div class="carousel-content">
                                <div class="space-y-4" id="dpr-summary">
                                    <div class="flex justify-center items-center h-40">
                                        <div class="loader"></div>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="h-60">
                                        <canvas id="dailyProgressChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Manpower Updates Slide -->
                        <div class="carousel-slide" id="carousel-slide-2">
                            <div class="carousel-title">
                                <h3 class="text-lg font-semibold text-gray-800">Manpower Updates</h3>
                                <a href="#manpower-content" class="text-sm text-blue-600 hover:underline">View All</a>
                            </div>
                            <div class="carousel-content">
                                <div class="vertical-ticker-container" id="vertical-ticker-container">
                                    <div class="vertical-ticker" id="vertical-ticker">
                                        <!-- Will be populated by JavaScript -->
                                        <div class="flex justify-center items-center h-40">
                                            <div class="loader"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Productivity Overview Slide -->
                        <div class="carousel-slide" id="carousel-slide-3">
                            <div class="carousel-title">
                                <h3 class="text-lg font-semibold text-gray-800">Productivity Overview</h3>
                                <a href="#productivity-content" class="text-sm text-blue-600 hover:underline">View All</a>
                            </div>
                            <div class="carousel-content">
                                <div class="space-y-4" id="productivity-summary">
                                    <div class="flex justify-center items-center h-40">
                                        <div class="loader"></div>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <div class="h-60">
                                        <canvas id="productivitySummaryChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Carousel Indicators -->
                        <div class="carousel-indicators">
                            <div class="carousel-indicator active" data-slide="1"></div>
                            <div class="carousel-indicator" data-slide="2"></div>
                            <div class="carousel-indicator" data-slide="3"></div>
                        </div>
                    </div>
                </div>

                <!-- Supervisor of the Month Card -->
                <div class="dashboard-card bg-white p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 text-center">Supervisor of the Month</h3>
                    <div class="flex flex-col items-center">
                        <div class="supervisor-image-container float-animation">
                            <img id="supervisor-image" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='150' viewBox='0 0 24 24' fill='none' stroke='%233b82f6' stroke-width='1' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2'%3E%3C/path%3E%3Ccircle cx='12' cy='7' r='4'%3E%3C/circle%3E%3C/svg%3E" alt="Supervisor of the Month" class="supervisor-image">
                            <label for="image-upload" class="image-upload-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </label>
                            <input type="file" id="image-upload" class="file-input" accept="image/*">
                        </div>
                        <input type="text" id="supervisor-name" class="supervisor-name-input" placeholder="Enter Supervisor Name" value="Gurwinder Singh">
                    </div>
                    <div class="mt-6">
                        <h4 class="text-xl font-semibold text-blue-700 mb-2">Achievement Highlights</h4>
                        <ul class="list-disc list-inside space-y-2 text-gray-700" id="achievement-list">
                            <li class="achievement-item">Highest productivity rate of 2.8 m³/hr</li>
                            <li class="achievement-item">Completed 450 m³ of erection work</li>
                            <li class="achievement-item">Managed a team of 15 workers with perfect safety record</li>
                            <li class="achievement-item">Reduced material wastage by 15%</li>
                            <li class="achievement-item">Completed all assigned tasks ahead of schedule</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Tabs Navigation -->
            <div class="mb-6 border-b border-gray-200">
                <div class="flex overflow-x-auto">
                    <div class="tab tab-active" data-tab="dpr">Daily Progress Report</div>
                    <div class="tab" data-tab="manpower">Manpower</div>
                    <div class="tab" data-tab="productivity">Productivity</div>
                </div>
            </div>

            <!-- Tab Content -->
            <div class="content-section active" id="dpr-content">
                <div class="dashboard-card bg-white p-6">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <h3 class="text-lg font-semibold text-gray-800">Daily Progress Report</h3>
                        <div class="flex flex-wrap gap-2">
                            <div class="relative">
                                <input type="date" id="dpr-date-filter" class="border border-gray-300 rounded-md px-3 py-2 text-sm">
                            </div>
                            <select id="dpr-supervisor-filter" class="border border-gray-300 rounded-md px-3 py-2 text-sm">
                                <option value="all">All Supervisors</option>
                                <!-- Will be populated by JavaScript -->
                            </select>
                            <select id="dpr-worktype-filter" class="border border-gray-300 rounded-md px-3 py-2 text-sm">
                                <option value="all">All Work Types</option>
                                <option value="ERECTION">ERECTION</option>
                                <option value="DISMANTLING">DISMANTLING</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="min-w-full">
                            <thead>
                                <tr>
                                    <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Date</th>
                                    <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Supervisor Name</th>
                                    <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Work Type</th>
                                    <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Length (m)</th>
                                    <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Width (m)</th>
                                    <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Height (m)</th>
                                    <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Qty</th>
                                    <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Volume (m³)</th>
                                </tr>
                            </thead>
                            <tbody id="dpr-table">
                                <!-- Will be populated by JavaScript -->
                                <tr>
                                    <td colspan="8" class="text-center py-4">
                                        <div class="loader mx-auto"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="content-section" id="manpower-content">
                <div class="dashboard-card bg-white p-6 mb-6">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                        <h3 class="text-lg font-semibold text-gray-800">Manpower Attendance</h3>
                        <div class="flex flex-wrap gap-2">
                            <div class="relative">
                                <input type="date" id="manpower-date-filter" class="border border-gray-300 rounded-md px-3 py-2 text-sm">
                            </div>
                            <select id="manpower-supervisor-filter" class="border border-gray-300 rounded-md px-3 py-2 text-sm">
                                <option value="all">All Supervisors</option>
                                <!-- Will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="relative">
                        <div class="attendance-slider flex space-x-4 pb-4" id="attendance-slider">
                            <!-- Will be populated by JavaScript -->
                            <div class="flex justify-center items-center w-full h-40">
                                <div class="loader"></div>
                            </div>
                        </div>
                        <button id="prev-btn" class="absolute left-0 top-1/2 transform -translate-y-1/2 bg-white rounded-full p-2 shadow-md z-10 hover:bg-gray-100">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                            </svg>
                        </button>
                        <button id="next-btn" class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-white rounded-full p-2 shadow-md z-10 hover:bg-gray-100">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="dashboard-card bg-white p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-800">Manpower Details</h3>
                    </div>
                    <div class="table-container">
                        <table class="min-w-full">
                            <thead>
                                <tr>
                                    <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Date</th>
                                    <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Supervisor Name</th>
                                    <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Employee Name</th>
                                    <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">OT Hours</th>
                                    <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Total Manhours</th>
                                    <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Status</th>
                                </tr>
                            </thead>
                            <tbody id="manpower-table">
                                <!-- Will be populated by JavaScript -->
                                <tr>
                                    <td colspan="6" class="text-center py-4">
                                        <div class="loader mx-auto"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="content-section" id="productivity-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="dashboard-card bg-white p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Supervisor Productivity</h3>
                        <div class="table-container">
                            <table class="min-w-full">
                                <thead>
                                    <tr>
                                        <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Supervisor Name</th>
                                        <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Erection (m³)</th>
                                        <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Dismantling (m³)</th>
                                        <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Equivalent (m³)</th>
                                        <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Total Manhours</th>
                                        <th class="bg-blue-700 text-white px-4 py-3 text-left text-sm font-medium">Productivity</th>
                                    </tr>
                                </thead>
                                <tbody id="productivity-table">
                                    <!-- Will be populated by JavaScript -->
                                    <tr>
                                        <td colspan="6" class="text-center py-4">
                                            <div class="loader mx-auto"></div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="dashboard-card bg-white p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Productivity Comparison</h3>
                        <div class="h-80">
                            <canvas id="productivityChart"></canvas>
                        </div>
                    </div>

                    <div class="dashboard-card bg-white p-6 lg:col-span-2">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Weekly Productivity Trend</h3>
                        <div class="h-80">
                            <canvas id="weeklyProductivityChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-6">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0">
                        <h3 class="text-xl font-bold">CDH Data Dashboard</h3>
                        <p class="text-gray-400">© 2025 All Rights Reserved</p>
                    </div>
                    <div>
                        <p class="text-gray-400">Site Manager: Gurwinder Singh</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // CSV URLs
        const DPR_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR770AQ-HHixlcLynNRlnX01iKGuoWbQjYKL4HuVkL6dkiQlneLSmavh0ol0qfNln4UTN20ZXIQ8yuY/pub?gid=0&single=true&output=csv';
        const MANPOWER_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR770AQ-HHixlcLynNRlnX01iKGuoWbQjYKL4HuVkL6dkiQlneLSmavh0ol0qfNln4UTN20ZXIQ8yuY/pub?gid=1128347685&single=true&output=csv';
        const PRODUCTIVITY_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR770AQ-HHixlcLynNRlnX01iKGuoWbQjYKL4HuVkL6dkiQlneLSmavh0ol0qfNln4UTN20ZXIQ8yuY/pub?gid=67021281&single=true&output=csv';
        const ALL_OVER_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR770AQ-HHixlcLynNRlnX01iKGuoWbQjYKL4HuVkL6dkiQlneLSmavh0ol0qfNln4UTN20ZXIQ8yuY/pub?gid=834519060&single=true&output=csv';

        // Global data storage
        let dprData = [];
        let manpowerData = [];
        let productivityData = [];
        let overallData = [];
        
        // Charts
        let performanceChart;
        let productivityChart;
        let weeklyProductivityChart;
        let dailyProgressChart;
        let productivitySummaryChart;

        // Auto-refresh timer
        let refreshInterval;
        let refreshCountdown;
        const REFRESH_INTERVAL = 60 * 60; // 1 hour in seconds

        // Carousel variables
        let carouselInterval;
        let currentSlide = 1;
        const CAROUSEL_INTERVAL = 10000; // 10 seconds per slide
        const ANIMATION_EFFECTS = ['animate-fade-in', 'animate-slide-up', 'animate-scale-in', 'animate-rotate-in', 'animate-bounce-in', 'animate-slide-left', 'animate-slide-right'];

        // Vertical ticker variables
        let verticalTickerInterval;
        let verticalTickerPosition = 0;
        const VERTICAL_TICKER_INTERVAL = 3000; // 3 seconds per item

        // Function to fetch CSV data
        async function fetchCSV(url) {
            try {
                const response = await fetch(url);
                const csvText = await response.text();
                
                return new Promise((resolve) => {
                    Papa.parse(csvText, {
                        header: true,
                        dynamicTyping: true,
                        skipEmptyLines: true,
                        complete: function(results) {
                            resolve(results.data);
                        }
                    });
                });
            } catch (error) {
                console.error('Error fetching CSV:', error);
                return [];
            }
        }

        // Function to format date strings
        function formatDate(dateString) {
            if (!dateString) return '';
            
            // Check if the date is in DD-MM-YYYY format
            if (dateString.includes('-') && dateString.split('-')[0].length === 2) {
                const [day, month, year] = dateString.split('-');
                return `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
            }
            
            // If already in YYYY-MM-DD format
            return dateString;
        }

        // Function to parse numeric values safely
        function parseNumeric(value) {
            if (value === null || value === undefined || value === '') return 0;
            if (typeof value === 'number') return value;
            if (typeof value === 'string') {
                // Remove any non-numeric characters except decimal point
                const cleaned = value.replace(/[^\d.-]/g, '');
                return parseFloat(cleaned) || 0;
            }
            return 0;
        }

        // Function to load all data
        async function loadAllData() {
            try {
                // Show loading overlay
                document.getElementById('loading-overlay').style.display = 'flex';
                
                // Fetch all data in parallel
                const [dprResult, manpowerResult, productivityResult, overallResult] = await Promise.all([
                    fetchCSV(DPR_URL),
                    fetchCSV(MANPOWER_URL),
                    fetchCSV(PRODUCTIVITY_URL),
                    fetchCSV(ALL_OVER_URL)
                ]);
                
                // Process DPR data
                dprData = dprResult.map(item => ({
                    date: formatDate(item.DATE),
                    supervisor: item['SUPERVISOR NAME'],
                    workType: item['WORK TYPE'],
                    length: parseNumeric(item.LENGTH),
                    width: parseNumeric(item.WIDTH),
                    height: parseNumeric(item.HEIGHT),
                    qty: parseNumeric(item.QTY),
                    volume: parseNumeric(item.VOLUME)
                }));
                
                // Process Manpower data
                manpowerData = manpowerResult.map(item => ({
                    date: formatDate(item.DATE),
                    supervisor: item['SUPERVISOR NAME'],
                    empName: item['EMP NAME'],
                    otHours: parseNumeric(item['OT HOURS']),
                    totalManhours: parseNumeric(item['TOTAL MANHOURS'])
                }));
                
                // Process Productivity data
                productivityData = productivityResult.map(item => ({
                    supervisor: item['SUP NAME'],
                    erection: parseNumeric(item.ERECTION),
                    dismantling: parseNumeric(item.DISMANTLING),
                    equivalent: parseNumeric(item.EQUILVENT),
                    totalManhours: parseNumeric(item['TOTAL MANHOURS']),
                    productivity: item.PRODUCTIVITY === '#DIV/0!' ? 0 : parseNumeric(item.PRODUCTIVITY)
                }));
                
                // Process Overall data
                overallData = overallResult.map(item => ({
                    date: formatDate(item.DATE),
                    erection: parseNumeric(item.ERECTION),
                    dismantling: parseNumeric(item.DISMANTLING),
                    totalManhours: parseNumeric(item['TOTAL MANHOURS']),
                    target: parseNumeric(item.TARGET),
                    achieved: parseNumeric(item.ACHEIVED)
                }));
                
                // Update the UI with the loaded data
                updateUI();
                
                // Hide loading overlay
                document.getElementById('loading-overlay').style.display = 'none';
                
                // Update last updated time
                document.getElementById('last-updated').textContent = new Date().toLocaleString();
                
                // Reset the refresh countdown
                resetRefreshCountdown();
                
                // Apply animations to summary cards
                animateSummaryCards();
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading-overlay').style.display = 'none';
                alert('Error loading data. Please try refreshing the page.');
            }
        }

        // Function to update the UI with loaded data
        function updateUI() {
            // Update summary cards
            updateSummaryCards();
            
            // Update DPR table and summary
            updateDPRTable();
            updateDPRSummary();
            
            // Update Manpower table, attendance cards, and ticker
            updateManpowerTable();
            updateManpowerTicker();
            updateVerticalManpowerTicker();
            
            // Update Productivity table and summary
            updateProductivityTable();
            updateProductivitySummary();
            
            // Update charts
            updateCharts();
            
            // Set up filters
            setupFilters();
            
            // Start the carousel
            startCarousel();
            
            // Start the vertical ticker
            startVerticalTicker();
            
            // Apply animations to achievement items
            animateAchievementItems();
        }

        // Function to update summary cards
        function updateSummaryCards() {
            // Calculate totals from productivity data
            const totalErection = productivityData.reduce((sum, item) => sum + parseNumeric(item.erection), 0);
            document.getElementById('total-erection').textContent = totalErection.toFixed(2) + ' m³';
            
            const totalDismantling = productivityData.reduce((sum, item) => sum + parseNumeric(item.dismantling), 0);
            document.getElementById('total-dismantling').textContent = totalDismantling.toFixed(2) + ' m³';
            
            const totalManhours = productivityData.reduce((sum, item) => sum + parseNumeric(item.totalManhours), 0);
            document.getElementById('total-manhours').textContent = totalManhours.toFixed(0) + ' hrs';
            
            // Calculate average productivity
            const validProductivity = productivityData.filter(item => item.productivity > 0);
            const avgProductivity = validProductivity.length > 0 ? 
                validProductivity.reduce((sum, item) => sum + item.productivity, 0) / validProductivity.length : 0;
            document.getElementById('productivity-value').textContent = avgProductivity.toFixed(2) + ' m³/hr';
            
            // Update progress bars
            const targetTotal = overallData.reduce((sum, item) => sum + parseNumeric(item.target), 0);
            const erectionProgress = targetTotal > 0 ? (totalErection / targetTotal) * 100 : 0;
            document.getElementById('erection-progress').textContent = Math.min(100, erectionProgress.toFixed(0)) + '%';
            document.getElementById('erection-progress-bar').style.width = Math.min(100, erectionProgress) + '%';
            
            const dismantlingProgress = targetTotal > 0 ? (totalDismantling / targetTotal) * 100 : 0;
            document.getElementById('dismantling-progress').textContent = Math.min(100, dismantlingProgress.toFixed(0)) + '%';
            document.getElementById('dismantling-progress-bar').style.width = Math.min(100, dismantlingProgress) + '%';
            
            // Assuming 8 hours per person is standard
            const manhoursUtilization = manpowerData.length > 0 ? (totalManhours / (manpowerData.length * 8)) * 100 : 0;
            document.getElementById('manhours-utilization').textContent = Math.min(100, manhoursUtilization.toFixed(0)) + '%';
            document.getElementById('manhours-progress-bar').style.width = Math.min(100, manhoursUtilization) + '%';
            
            // Assuming target productivity is 2.0 m³/hr
            const targetProductivity = 2.0;
            const productivityProgress = (avgProductivity / targetProductivity) * 100;
            document.getElementById('productivity-target').textContent = Math.min(100, productivityProgress.toFixed(0)) + '%';
            document.getElementById('productivity-progress-bar').style.width = Math.min(100, productivityProgress) + '%';
        }

        // Function to animate summary cards
        function animateSummaryCards() {
            const cards = document.querySelectorAll('.summary-card');
            
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add(ANIMATION_EFFECTS[index % ANIMATION_EFFECTS.length]);
                    
                    // Add pulse animation to the icon
                    const icon = card.querySelector('.summary-icon');
                    if (icon) {
                        icon.classList.add('pulse-animation');
                    }
                }, index * 200);
            });
        }

        // Function to animate achievement items
        function animateAchievementItems() {
            const items = document.querySelectorAll('.achievement-item');
            
            items.forEach((item, index) => {
                setTimeout(() => {
                    item.classList.add('animate-slide-right');
                }, index * 200);
            });
        }

        // Function to update DPR table
        function updateDPRTable() {
            const dprTable = document.getElementById('dpr-table');
            dprTable.innerHTML = '';
            
            if (dprData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="8" class="text-center py-4">No data available</td>`;
                dprTable.appendChild(row);
                return;
            }
            
            dprData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'opacity-0';
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm">${item.date || ''}</td>
                    <td class="px-4 py-3 text-sm">${item.supervisor || ''}</td>
                    <td class="px-4 py-3 text-sm">${item.workType || ''}</td>
                    <td class="px-4 py-3 text-sm">${item.length?.toFixed(2) || '0.00'}</td>
                    <td class="px-4 py-3 text-sm">${item.width?.toFixed(2) || '0.00'}</td>
                    <td class="px-4 py-3 text-sm">${item.height?.toFixed(2) || '0.00'}</td>
                    <td class="px-4 py-3 text-sm">${item.qty || '0'}</td>
                    <td class="px-4 py-3 text-sm font-medium">${item.volume?.toFixed(2) || '0.00'}</td>
                `;
                dprTable.appendChild(row);
                
                // Animate row appearance with delay
                setTimeout(() => {
                    row.classList.add('animate-fade-in');
                    row.classList.remove('opacity-0');
                }, index * 50);
            });
            
            // Populate supervisor filter
            const supervisorFilter = document.getElementById('dpr-supervisor-filter');
            supervisorFilter.innerHTML = '<option value="all">All Supervisors</option>';
            
            const supervisors = [...new Set(dprData.map(item => item.supervisor).filter(Boolean))];
            supervisors.forEach(supervisor => {
                const option = document.createElement('option');
                option.value = supervisor;
                option.textContent = supervisor;
                supervisorFilter.appendChild(option);
            });
            
            // Set default date to most recent date in data
            const dates = dprData.map(item => item.date).filter(Boolean);
            if (dates.length > 0) {
                const latestDate = new Date(Math.max(...dates.map(date => new Date(date))));
                document.getElementById('dpr-date-filter').value = latestDate.toISOString().split('T')[0];
            }
        }

        // Function to update DPR Summary
        function updateDPRSummary() {
            const dprSummary = document.getElementById('dpr-summary');
            dprSummary.innerHTML = '';
            
            if (dprData.length === 0) {
                dprSummary.innerHTML = '<div class="flex justify-center items-center h-40"><p>No data available</p></div>';
                return;
            }
            
            // Get the most recent date
            const dates = dprData.map(item => item.date).filter(Boolean);
            const latestDate = new Date(Math.max(...dates.map(date => new Date(date))));
            const latestDateStr = latestDate.toISOString().split('T')[0];
            
            // Filter data for the latest date
            const latestData = dprData.filter(item => item.date === latestDateStr);
            
            // Calculate totals for the latest date
            const totalErection = latestData
                .filter(item => item.workType === 'ERECTION')
                .reduce((sum, item) => sum + parseNumeric(item.volume), 0);
                
            const totalDismantling = latestData
                .filter(item => item.workType === 'DISMANTLING')
                .reduce((sum, item) => sum + parseNumeric(item.volume), 0);
            
            // Create summary elements with animation classes
            const dateElement = document.createElement('div');
            dateElement.className = 'text-sm text-gray-500 mb-2 opacity-0';
            dateElement.textContent = `Latest Data: ${new Date(latestDateStr).toLocaleDateString()}`;
            
            const erectionElement = document.createElement('div');
            erectionElement.className = 'flex justify-between items-center mb-2 opacity-0';
            erectionElement.innerHTML = `
                <span class="font-medium">Erection:</span>
                <span class="text-blue-600 font-semibold">${totalErection.toFixed(2)} m³</span>
            `;
            
            const dismantlingElement = document.createElement('div');
            dismantlingElement.className = 'flex justify-between items-center mb-2 opacity-0';
            dismantlingElement.innerHTML = `
                <span class="font-medium">Dismantling:</span>
                <span class="text-green-600 font-semibold">${totalDismantling.toFixed(2)} m³</span>
            `;
            
            const totalElement = document.createElement('div');
            totalElement.className = 'flex justify-between items-center pt-2 border-t border-gray-200 opacity-0';
            totalElement.innerHTML = `
                <span class="font-medium">Total Volume:</span>
                <span class="text-purple-600 font-semibold">${(totalErection + totalDismantling).toFixed(2)} m³</span>
            `;
            
            // Append elements to summary
            dprSummary.appendChild(dateElement);
            dprSummary.appendChild(erectionElement);
            dprSummary.appendChild(dismantlingElement);
            dprSummary.appendChild(totalElement);
            
            // Apply animations with delay
            setTimeout(() => {
                dateElement.classList.add('animate-fade-in');
                dateElement.classList.remove('opacity-0');
            }, 100);
            
            setTimeout(() => {
                erectionElement.classList.add('animate-slide-right');
                erectionElement.classList.remove('opacity-0');
            }, 300);
            
            setTimeout(() => {
                dismantlingElement.classList.add('animate-slide-right');
                dismantlingElement.classList.remove('opacity-0');
            }, 500);
            
            setTimeout(() => {
                totalElement.classList.add('animate-slide-up');
                totalElement.classList.remove('opacity-0');
            }, 700);
            
            // Update Daily Progress Chart
            updateDailyProgressChart();
        }

        // Function to update Daily Progress Chart
        function updateDailyProgressChart() {
            const ctx = document.getElementById('dailyProgressChart').getContext('2d');
            
            // Get the last 7 days of data
            const sortedData = [...overallData]
                .filter(item => item.date)
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(-7);
            
            if (dailyProgressChart) {
                dailyProgressChart.destroy();
            }
            
            dailyProgressChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedData.map(item => {
                        const date = new Date(item.date);
                        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    }),
                    datasets: [
                        {
                            label: 'Erection',
                            data: sortedData.map(item => item.erection),
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Dismantling',
                            data: sortedData.map(item => item.dismantling),
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 2000,
                        easing: 'easeOutQuart'
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Volume (m³)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: false
                        }
                    }
                }
            });
        }

        // Function to update Manpower table and attendance cards
        function updateManpowerTable() {
            const manpowerTable = document.getElementById('manpower-table');
            manpowerTable.innerHTML = '';
            
            if (manpowerData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" class="text-center py-4">No data available</td>`;
                manpowerTable.appendChild(row);
                return;
            }
            
            manpowerData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'opacity-0';
                const status = parseNumeric(item.totalManhours) > 8 ? 
                    `<span class="status-badge status-overtime">Present + OT</span>` : 
                    `<span class="status-badge status-present">Present</span>`;
                
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm">${item.date || ''}</td>
                    <td class="px-4 py-3 text-sm">${item.supervisor || ''}</td>
                    <td class="px-4 py-3 text-sm font-medium">${item.empName || ''}</td>
                    <td class="px-4 py-3 text-sm">${item.otHours || '0'}</td>
                    <td class="px-4 py-3 text-sm">${item.totalManhours || '0'}</td>
                    <td class="px-4 py-3 text-sm">${status}</td>
                `;
                manpowerTable.appendChild(row);
                
                // Animate row appearance with delay
                setTimeout(() => {
                    row.classList.add('animate-fade-in');
                    row.classList.remove('opacity-0');
                }, index * 50);
            });
            
            // Update attendance cards
            updateAttendanceCards();
            
            // Populate supervisor filter
            const supervisorFilter = document.getElementById('manpower-supervisor-filter');
            supervisorFilter.innerHTML = '<option value="all">All Supervisors</option>';
            
            const supervisors = [...new Set(manpowerData.map(item => item.supervisor).filter(Boolean))];
            supervisors.forEach(supervisor => {
                const option = document.createElement('option');
                option.value = supervisor;
                option.textContent = supervisor;
                supervisorFilter.appendChild(option);
            });
            
            // Set default date to most recent date in data
            const dates = manpowerData.map(item => item.date).filter(Boolean);
            if (dates.length > 0) {
                const latestDate = new Date(Math.max(...dates.map(date => new Date(date))));
                document.getElementById('manpower-date-filter').value = latestDate.toISOString().split('T')[0];
            }
        }

        // Function to update attendance cards
        function updateAttendanceCards() {
            const attendanceSlider = document.getElementById('attendance-slider');
            attendanceSlider.innerHTML = '';
            
            if (manpowerData.length === 0) {
                attendanceSlider.innerHTML = '<div class="flex justify-center items-center w-full h-40"><p>No attendance data available</p></div>';
                return;
            }
            
            manpowerData.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'attendance-card bg-white rounded-lg shadow-md p-4 flex flex-col opacity-0';
                
                const status = parseNumeric(item.totalManhours) > 8 ? 
                    `<span class="status-badge status-overtime">Present + OT</span>` : 
                    `<span class="status-badge status-present">Present</span>`;
                
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-semibold text-gray-800">${item.empName || 'Unknown'}</h4>
                            <p class="text-xs text-gray-500">${item.supervisor || ''}</p>
                        </div>
                        ${status}
                    </div>
                    <div class="mt-auto">
                        <div class="flex justify-between text-xs text-gray-600 mb-1">
                            <span>Hours</span>
                            <span>${item.totalManhours || '0'} hrs</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-value ${parseNumeric(item.totalManhours) > 8 ? 'bg-amber-500' : 'bg-green-500'}" 
                                style="width: ${(parseNumeric(item.totalManhours) / 12) * 100}%"></div>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">Date: ${item.date || ''}</p>
                    </div>
                `;
                attendanceSlider.appendChild(card);
                
                // Animate card appearance with delay
                setTimeout(() => {
                    card.classList.add(ANIMATION_EFFECTS[index % ANIMATION_EFFECTS.length]);
                    card.classList.remove('opacity-0');
                }, index * 100);
            });
        }

        // Function to update Manpower Ticker
        function updateManpowerTicker() {
            const tickerItems = document.getElementById('manpower-ticker-items');
            if (!tickerItems) return;
            
            tickerItems.innerHTML = '';
            
            if (manpowerData.length === 0) {
                tickerItems.innerHTML = '<div class="flex justify-center items-center h-40"><p>No manpower data available</p></div>';
                return;
            }
            
            // Get the most recent date
            const dates = manpowerData.map(item => item.date).filter(Boolean);
            const latestDate = new Date(Math.max(...dates.map(date => new Date(date))));
            const latestDateStr = latestDate.toISOString().split('T')[0];
            
            // Filter data for the latest date
            const latestData = manpowerData.filter(item => item.date === latestDateStr);
            
            // Create ticker items
            latestData.forEach((item, index) => {
                const tickerItem = document.createElement('div');
                tickerItem.className = 'manpower-ticker-item p-4 mb-4 bg-white rounded-lg shadow-sm opacity-0';
                
                const status = parseNumeric(item.totalManhours) > 8 ? 
                    `<span class="status-badge status-overtime">Present + OT</span>` : 
                    `<span class="status-badge status-present">Present</span>`;
                
                tickerItem.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold text-gray-800">${item.empName || 'Unknown'}</h4>
                        ${status}
                    </div>
                    <p class="text-sm text-gray-600">Supervisor: ${item.supervisor || ''}</p>
                    <div class="mt-3">
                        <div class="flex justify-between text-xs text-gray-600 mb-1">
                            <span>Hours</span>
                            <span>${item.totalManhours || '0'} hrs</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-value ${parseNumeric(item.totalManhours) > 8 ? 'bg-amber-500' : 'bg-green-500'}" 
                                style="width: ${(parseNumeric(item.totalManhours) / 12) * 100}%"></div>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Date: ${item.date || ''}</p>
                `;
                
                // Add animation with delay based on index
                setTimeout(() => {
                    tickerItem.classList.add(ANIMATION_EFFECTS[index % ANIMATION_EFFECTS.length]);
                    tickerItem.classList.remove('opacity-0');
                }, index * 100);
                
                tickerItems.appendChild(tickerItem);
            });
        }

        // Function to update Vertical Manpower Ticker
        function updateVerticalManpowerTicker() {
            const verticalTicker = document.getElementById('vertical-ticker');
            verticalTicker.innerHTML = '';
            
            if (manpowerData.length === 0) {
                verticalTicker.innerHTML = '<div class="flex justify-center items-center h-40"><p>No manpower data available</p></div>';
                return;
            }
            
            // Get the most recent date
            const dates = manpowerData.map(item => item.date).filter(Boolean);
            const latestDate = new Date(Math.max(...dates.map(date => new Date(date))));
            const latestDateStr = latestDate.toISOString().split('T')[0];
            
            // Filter data for the latest date
            const latestData = manpowerData.filter(item => item.date === latestDateStr);
            
            // Create ticker items
            latestData.forEach((item, index) => {
                const tickerItem = document.createElement('div');
                tickerItem.className = 'vertical-ticker-item';
                tickerItem.setAttribute('data-index', index);
                
                const status = parseNumeric(item.totalManhours) > 8 ? 
                    `<span class="status-badge status-overtime">Present + OT</span>` : 
                    `<span class="status-badge status-present">Present</span>`;
                
                tickerItem.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-semibold text-gray-800">${item.empName || 'Unknown'}</h4>
                            <p class="text-xs text-gray-500">Supervisor: ${item.supervisor || ''}</p>
                        </div>
                        <div class="flex flex-col items-end">
                            ${status}
                            <span class="text-sm font-medium mt-1">${item.totalManhours || '0'} hrs</span>
                        </div>
                    </div>
                `;
                
                verticalTicker.appendChild(tickerItem);
            });
            
            // Set the height of each ticker item
            const tickerItems = verticalTicker.querySelectorAll('.vertical-ticker-item');
            const itemHeight = 80; // Fixed height for each item
            
            tickerItems.forEach(item => {
                item.style.height = `${itemHeight}px`;
            });
            
            // Set the total height of the ticker
            verticalTicker.style.height = `${tickerItems.length * itemHeight}px`;
        }

        // Function to start the vertical ticker
        function startVerticalTicker() {
            // Clear any existing interval
            if (verticalTickerInterval) {
                clearInterval(verticalTickerInterval);
            }
            
            const verticalTicker = document.getElementById('vertical-ticker');
            const tickerContainer = document.getElementById('vertical-ticker-container');
            
            if (!verticalTicker || !tickerContainer) return;
            
            const tickerItems = verticalTicker.querySelectorAll('.vertical-ticker-item');
            if (tickerItems.length === 0) return;
            
            const itemHeight = 80; // Fixed height for each item
            let currentIndex = 0;
            
            // Show the first item
            verticalTicker.style.transform = `translateY(0)`;
            
            // Start the interval
            verticalTickerInterval = setInterval(() => {
                currentIndex = (currentIndex + 1) % tickerItems.length;
                verticalTicker.style.transform = `translateY(-${currentIndex * itemHeight}px)`;
                
                // Apply animation to the current item
                tickerItems.forEach(item => {
                    item.classList.remove('bg-blue-50');
                });
                
                if (tickerItems[currentIndex]) {
                    tickerItems[currentIndex].classList.add('bg-blue-50');
                }
            }, VERTICAL_TICKER_INTERVAL);
        }

        // Function to update Productivity table
        function updateProductivityTable() {
            const productivityTable = document.getElementById('productivity-table');
            productivityTable.innerHTML = '';
            
            if (productivityData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" class="text-center py-4">No data available</td>`;
                productivityTable.appendChild(row);
                return;
            }
            
            productivityData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = 'opacity-0';
                const productivityValue = isNaN(item.productivity) || item.productivity === null ? 
                    'N/A' : item.productivity.toFixed(2);
                
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm font-medium">${item.supervisor || ''}</td>
                    <td class="px-4 py-3 text-sm">${item.erection?.toFixed(2) || '0.00'}</td>
                    <td class="px-4 py-3 text-sm">${item.dismantling?.toFixed(2) || '0.00'}</td>
                    <td class="px-4 py-3 text-sm">${item.equivalent?.toFixed(2) || '0.00'}</td>
                    <td class="px-4 py-3 text-sm">${item.totalManhours?.toFixed(1) || '0.0'}</td>
                    <td class="px-4 py-3 text-sm font-medium ${parseNumeric(item.productivity) > 0 ? 'text-green-600' : 'text-gray-500'}">${productivityValue}</td>
                `;
                productivityTable.appendChild(row);
                
                // Animate row appearance with delay
                setTimeout(() => {
                    row.classList.add('animate-fade-in');
                    row.classList.remove('opacity-0');
                }, index * 50);
            });
        }

        // Function to update Productivity Summary
        function updateProductivitySummary() {
            const productivitySummary = document.getElementById('productivity-summary');
            productivitySummary.innerHTML = '';
            
            if (productivityData.length === 0) {
                productivitySummary.innerHTML = '<div class="flex justify-center items-center h-40"><p>No productivity data available</p></div>';
                return;
            }
            
            // Sort by productivity (highest first)
            const sortedData = [...productivityData]
                .filter(item => item.productivity > 0)
                .sort((a, b) => b.productivity - a.productivity);
            
            // If no valid productivity data
            if (sortedData.length === 0) {
                productivitySummary.innerHTML = '<div class="flex justify-center items-center h-40"><p>No valid productivity data available</p></div>';
                return;
            }
            
            // Get the top performer
            const topPerformer = sortedData[0];
            
            // Create summary elements with animation classes
            const topElement = document.createElement('div');
            topElement.className = 'text-sm text-gray-500 mb-2 opacity-0';
            topElement.textContent = 'Top Performer:';
            
            const nameElement = document.createElement('div');
            nameElement.className = 'text-lg font-semibold text-blue-700 mb-2 opacity-0';
            nameElement.textContent = topPerformer.supervisor;
            
            const productivityElement = document.createElement('div');
            productivityElement.className = 'flex justify-between items-center mb-2 opacity-0';
            productivityElement.innerHTML = `
                <span class="font-medium">Productivity:</span>
                <span class="text-green-600 font-semibold">${topPerformer.productivity.toFixed(2)} m³/hr</span>
            `;
            
            const volumeElement = document.createElement('div');
            volumeElement.className = 'flex justify-between items-center mb-2 opacity-0';
            volumeElement.innerHTML = `
                <span class="font-medium">Total Volume:</span>
                <span class="text-blue-600 font-semibold">${topPerformer.equivalent.toFixed(2)} m³</span>
            `;
            
            const hoursElement = document.createElement('div');
            hoursElement.className = 'flex justify-between items-center opacity-0';
            hoursElement.innerHTML = `
                <span class="font-medium">Total Hours:</span>
                <span class="text-purple-600 font-semibold">${topPerformer.totalManhours.toFixed(1)} hrs</span>
            `;
            
            // Append elements to summary
            productivitySummary.appendChild(topElement);
            productivitySummary.appendChild(nameElement);
            productivitySummary.appendChild(productivityElement);
            productivitySummary.appendChild(volumeElement);
            productivitySummary.appendChild(hoursElement);
            
            // Apply animations with delay
            setTimeout(() => {
                topElement.classList.add('animate-fade-in');
                topElement.classList.remove('opacity-0');
            }, 100);
            
            setTimeout(() => {
                nameElement.classList.add('animate-slide-up');
                nameElement.classList.remove('opacity-0');
            }, 300);
            
            setTimeout(() => {
                productivityElement.classList.add('animate-slide-right');
                productivityElement.classList.remove('opacity-0');
            }, 500);
            
            setTimeout(() => {
                volumeElement.classList.add('animate-slide-right');
                volumeElement.classList.remove('opacity-0');
            }, 700);
            
            setTimeout(() => {
                hoursElement.classList.add('animate-slide-right');
                hoursElement.classList.remove('opacity-0');
            }, 900);
            
            // Update Productivity Summary Chart
            updateProductivitySummaryChart();
        }

        // Function to update Productivity Summary Chart
        function updateProductivitySummaryChart() {
            const ctx = document.getElementById('productivitySummaryChart').getContext('2d');
            
            // Filter and sort data
            const chartData = [...productivityData]
                .filter(item => item.productivity > 0)
                .sort((a, b) => b.productivity - a.productivity)
                .slice(0, 5); // Top 5 performers
            
            if (productivitySummaryChart) {
                productivitySummaryChart.destroy();
            }
            
            productivitySummaryChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(item => item.supervisor),
                    datasets: [
                        {
                            label: 'Productivity (m³/hr)',
                            data: chartData.map(item => item.productivity),
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.7)',
                                'rgba(16, 185, 129, 0.7)',
                                'rgba(245, 158, 11, 0.7)',
                                'rgba(139, 92, 246, 0.7)',
                                'rgba(236, 72, 153, 0.7)'
                            ],
                            borderColor: [
                                'rgba(59, 130, 246, 1)',
                                'rgba(16, 185, 129, 1)',
                                'rgba(245, 158, 11, 1)',
                                'rgba(139, 92, 246, 1)',
                                'rgba(236, 72, 153, 1)'
                            ],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 2000,
                        easing: 'easeOutQuart'
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Productivity (m³/hr)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Top Performers'
                        }
                    }
                }
            });
        }

        // Function to update charts
        function updateCharts() {
            // Performance Chart
            updatePerformanceChart();
            
            // Productivity Comparison Chart
            updateProductivityComparisonChart();
            
            // Weekly Productivity Chart
            updateWeeklyProductivityChart();
        }

        // Function to update Performance Chart
        function updatePerformanceChart() {
            const ctx = document.getElementById('performanceChart')?.getContext('2d');
            if (!ctx) return;
            
            // Sort data by date
            const sortedData = [...overallData]
                .filter(item => item.date)
                .sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Take only the last 7 days with data
            const chartData = sortedData.slice(-7);
            
            if (performanceChart) {
                performanceChart.destroy();
            }
            
            performanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(item => {
                        const date = new Date(item.date);
                        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    }),
                    datasets: [
                        {
                            label: 'Erection',
                            data: chartData.map(item => item.erection),
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Dismantling',
                            data: chartData.map(item => item.dismantling),
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Target',
                            data: chartData.map(item => item.target),
                            type: 'line',
                            borderColor: 'rgba(245, 158, 11, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(245, 158, 11, 1)',
                            fill: false,
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 2000,
                        easing: 'easeOutQuart'
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Volume (m³)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: false,
                            text: 'Daily Performance'
                        }
                    }
                }
            });
        }

        // Function to update Productivity Comparison Chart
        function updateProductivityComparisonChart() {
            const ctx = document.getElementById('productivityChart')?.getContext('2d');
            if (!ctx) return;
            
            // Filter and sort data
            const chartData = [...productivityData]
                .filter(item => item.productivity > 0)
                .sort((a, b) => b.productivity - a.productivity);
            
            if (productivityChart) {
                productivityChart.destroy();
            }
            
            productivityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(item => item.supervisor),
                    datasets: [
                        {
                            label: 'Productivity (m³/hr)',
                            data: chartData.map(item => item.productivity),
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.7)',
                                'rgba(16, 185, 129, 0.7)',
                                'rgba(245, 158, 11, 0.7)',
                                'rgba(239, 68, 68, 0.7)',
                                'rgba(139, 92, 246, 0.7)',
                                'rgba(236, 72, 153, 0.7)',
                                'rgba(75, 85, 99, 0.7)'
                            ],
                            borderColor: [
                                'rgba(59, 130, 246, 1)',
                                'rgba(16, 185, 129, 1)',
                                'rgba(245, 158, 11, 1)',
                                'rgba(239, 68, 68, 1)',
                                'rgba(139, 92, 246, 1)',
                                'rgba(236, 72, 153, 1)',
                                'rgba(75, 85, 99, 1)'
                            ],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 2000,
                        easing: 'easeOutQuart'
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Productivity (m³/hr)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Function to update Weekly Productivity Chart
        function updateWeeklyProductivityChart() {
            const ctx = document.getElementById('weeklyProductivityChart')?.getContext('2d');
            if (!ctx) return;
            
            // Group data by week
            const weeklyData = groupDataByWeek(overallData);
            
            if (weeklyProductivityChart) {
                weeklyProductivityChart.destroy();
            }
            
            weeklyProductivityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weeklyData.map(item => `Week ${item.week}`),
                    datasets: [
                        {
                            label: 'Actual Productivity',
                            data: weeklyData.map(item => item.productivity),
                            borderColor: 'rgba(59, 130, 246, 1)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Target Productivity',
                            data: weeklyData.map(() => 2.0), // Assuming target is 2.0
                            borderColor: 'rgba(245, 158, 11, 1)',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 2000,
                        easing: 'easeOutQuart'
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Productivity (m³/hr)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        // Function to group data by week
        function groupDataByWeek(data) {
            const weeklyData = [];
            
            // Group data by week
            const weekMap = new Map();
            
            data.forEach(item => {
                if (!item.date) return;
                
                const date = new Date(item.date);
                const year = date.getFullYear();
                const weekNumber = getWeekNumber(date);
                const weekKey = `${year}-${weekNumber}`;
                
                if (!weekMap.has(weekKey)) {
                    weekMap.set(weekKey, {
                        week: weekNumber,
                        year: year,
                        totalVolume: 0,
                        totalManhours: 0,
                        dates: []
                    });
                }
                
                const weekData = weekMap.get(weekKey);
                weekData.totalVolume += parseNumeric(item.erection) + parseNumeric(item.dismantling);
                weekData.totalManhours += parseNumeric(item.totalManhours);
                weekData.dates.push(item.date);
            });
            
            // Calculate productivity for each week
            weekMap.forEach((value, key) => {
                const productivity = value.totalManhours > 0 ? value.totalVolume / value.totalManhours : 0;
                weeklyData.push({
                    week: value.week,
                    year: value.year,
                    productivity: productivity
                });
            });
            
            // Sort by year and week
            return weeklyData.sort((a, b) => {
                if (a.year !== b.year) return a.year - b.year;
                return a.week - b.week;
            });
        }

        // Function to get week number
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        // Function to set up filters
        function setupFilters() {
            // DPR filters
            const dprDateFilter = document.getElementById('dpr-date-filter');
            const dprSupervisorFilter = document.getElementById('dpr-supervisor-filter');
            const dprWorkTypeFilter = document.getElementById('dpr-worktype-filter');
            
            function filterDPRData() {
                const dateValue = dprDateFilter.value;
                const supervisorValue = dprSupervisorFilter.value;
                const workTypeValue = dprWorkTypeFilter.value;
                
                let filteredData = [...dprData];
                
                if (dateValue) {
                    filteredData = filteredData.filter(item => item.date === dateValue);
                }
                
                if (supervisorValue !== 'all') {
                    filteredData = filteredData.filter(item => item.supervisor === supervisorValue);
                }
                
                if (workTypeValue !== 'all') {
                    filteredData = filteredData.filter(item => item.workType === workTypeValue);
                }
                
                const dprTable = document.getElementById('dpr-table');
                dprTable.innerHTML = '';
                
                if (filteredData.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="8" class="text-center py-4">No data matches the selected filters</td>`;
                    dprTable.appendChild(row);
                    return;
                }
                
                filteredData.forEach((item, index) => {
                    const row = document.createElement('tr');
                    row.className = 'opacity-0';
                    row.innerHTML = `
                        <td class="px-4 py-3 text-sm">${item.date || ''}</td>
                        <td class="px-4 py-3 text-sm">${item.supervisor || ''}</td>
                        <td class="px-4 py-3 text-sm">${item.workType || ''}</td>
                        <td class="px-4 py-3 text-sm">${item.length?.toFixed(2) || '0.00'}</td>
                        <td class="px-4 py-3 text-sm">${item.width?.toFixed(2) || '0.00'}</td>
                        <td class="px-4 py-3 text-sm">${item.height?.toFixed(2) || '0.00'}</td>
                        <td class="px-4 py-3 text-sm">${item.qty || '0'}</td>
                        <td class="px-4 py-3 text-sm font-medium">${item.volume?.toFixed(2) || '0.00'}</td>
                    `;
                    dprTable.appendChild(row);
                    
                    // Animate row appearance with delay
                    setTimeout(() => {
                        row.classList.add('animate-fade-in');
                        row.classList.remove('opacity-0');
                    }, index * 50);
                });
            }
            
            dprDateFilter.addEventListener('change', filterDPRData);
            dprSupervisorFilter.addEventListener('change', filterDPRData);
            dprWorkTypeFilter.addEventListener('change', filterDPRData);
            
            // Manpower filters
            const manpowerDateFilter = document.getElementById('manpower-date-filter');
            const manpowerSupervisorFilter = document.getElementById('manpower-supervisor-filter');
            
            function filterManpowerData() {
                const dateValue = manpowerDateFilter.value;
                const supervisorValue = manpowerSupervisorFilter.value;
                
                let filteredData = [...manpowerData];
                
                if (dateValue) {
                    filteredData = filteredData.filter(item => item.date === dateValue);
                }
                
                if (supervisorValue !== 'all') {
                    filteredData = filteredData.filter(item => item.supervisor === supervisorValue);
                }
                
                const manpowerTable = document.getElementById('manpower-table');
                manpowerTable.innerHTML = '';
                
                if (filteredData.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="6" class="text-center py-4">No data matches the selected filters</td>`;
                    manpowerTable.appendChild(row);
                    
                    // Clear attendance cards
                    const attendanceSlider = document.getElementById('attendance-slider');
                    attendanceSlider.innerHTML = '<div class="flex justify-center items-center w-full h-40"><p>No attendance data matches the selected filters</p></div>';
                    return;
                }
                
                filteredData.forEach((item, index) => {
                    const row = document.createElement('tr');
                    row.className = 'opacity-0';
                    const status = parseNumeric(item.totalManhours) > 8 ? 
                        `<span class="status-badge status-overtime">Present + OT</span>` : 
                        `<span class="status-badge status-present">Present</span>`;
                    
                    row.innerHTML = `
                        <td class="px-4 py-3 text-sm">${item.date || ''}</td>
                        <td class="px-4 py-3 text-sm">${item.supervisor || ''}</td>
                        <td class="px-4 py-3 text-sm font-medium">${item.empName || ''}</td>
                        <td class="px-4 py-3 text-sm">${item.otHours || '0'}</td>
                        <td class="px-4 py-3 text-sm">${item.totalManhours || '0'}</td>
                        <td class="px-4 py-3 text-sm">${status}</td>
                    `;
                    manpowerTable.appendChild(row);
                    
                    // Animate row appearance with delay
                    setTimeout(() => {
                        row.classList.add('animate-fade-in');
                        row.classList.remove('opacity-0');
                    }, index * 50);
                });
                
                // Update attendance cards with filtered data
                const attendanceSlider = document.getElementById('attendance-slider');
                attendanceSlider.innerHTML = '';
                
                filteredData.forEach((item, index) => {
                    const card = document.createElement('div');
                    card.className = 'attendance-card bg-white rounded-lg shadow-md p-4 flex flex-col opacity-0';
                    
                    const status = parseNumeric(item.totalManhours) > 8 ? 
                        `<span class="status-badge status-overtime">Present + OT</span>` : 
                        `<span class="status-badge status-present">Present</span>`;
                    
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h4 class="font-semibold text-gray-800">${item.empName || 'Unknown'}</h4>
                                <p class="text-xs text-gray-500">${item.supervisor || ''}</p>
                            </div>
                            ${status}
                        </div>
                        <div class="mt-auto">
                            <div class="flex justify-between text-xs text-gray-600 mb-1">
                                <span>Hours</span>
                                <span>${item.totalManhours || '0'} hrs</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-value ${parseNumeric(item.totalManhours) > 8 ? 'bg-amber-500' : 'bg-green-500'}" 
                                    style="width: ${(parseNumeric(item.totalManhours) / 12) * 100}%"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">Date: ${item.date || ''}</p>
                        </div>
                    `;
                    attendanceSlider.appendChild(card);
                    
                    // Animate card appearance with delay
                    setTimeout(() => {
                        card.classList.add(ANIMATION_EFFECTS[index % ANIMATION_EFFECTS.length]);
                        card.classList.remove('opacity-0');
                    }, index * 100);
                });
            }
            
            manpowerDateFilter.addEventListener('change', filterManpowerData);
            manpowerSupervisorFilter.addEventListener('change', filterManpowerData);
        }

        // Attendance slider navigation
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const slider = document.getElementById('attendance-slider');
        
        nextBtn.addEventListener('click', () => {
            slider.scrollBy({ left: 500, behavior: 'smooth' });
        });
        
        prevBtn.addEventListener('click', () => {
            slider.scrollBy({ left: -500, behavior: 'smooth' });
        });

        // Tab switching functionality
        const tabs = document.querySelectorAll('.tab');
        const contentSections = document.querySelectorAll('.content-section');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Remove active class from all tabs and content sections
                tabs.forEach(t => t.classList.remove('tab-active'));
                contentSections.forEach(section => section.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content section
                tab.classList.add('tab-active');
                document.getElementById(`${tabId}-content`).classList.add('active');
                
                // Apply entrance animation to the content section
                const activeSection = document.getElementById(`${tabId}-content`);
                activeSection.classList.add('animate-fade-in');
                
                // Refresh charts if needed
                if (tabId === 'productivity') {
                    setTimeout(() => {
                        updateProductivityComparisonChart();
                        updateWeeklyProductivityChart();
                    }, 100);
                }
            });
        });

        // Refresh button functionality
        document.getElementById('refresh-btn').addEventListener('click', () => {
            // Add animation to the button
            const refreshBtn = document.getElementById('refresh-btn');
            refreshBtn.classList.add('animate-bounce-in');
            
            // Remove animation after it completes
            setTimeout(() => {
                refreshBtn.classList.remove('animate-bounce-in');
            }, 800);
            
            loadAllData();
        });

        // Function to format time as MM:SS
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // Function to update the refresh countdown timer
        function updateRefreshTimer() {
            const timerElement = document.getElementById('refresh-timer');
            refreshCountdown--;
            
            if (refreshCountdown <= 0) {
                // Time to refresh
                loadAllData();
                resetRefreshCountdown();
            } else {
                // Update the timer display
                timerElement.textContent = `Auto-refresh in ${formatTime(refreshCountdown)}`;
            }
        }

        // Function to reset the refresh countdown
        function resetRefreshCountdown() {
            refreshCountdown = REFRESH_INTERVAL;
            const timerElement = document.getElementById('refresh-timer');
            timerElement.textContent = `Auto-refresh in ${formatTime(refreshCountdown)}`;
        }

        // Function to setup auto-refresh
        function setupAutoRefresh() {
            // Clear any existing interval
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            
            // Initialize countdown
            resetRefreshCountdown();
            
            // Set up the interval to update every second
            refreshInterval = setInterval(updateRefreshTimer, 1000);
        }

        // Supervisor of the Month image upload
        document.getElementById('image-upload').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('supervisor-image').src = e.target.result;
                    // Store the image in localStorage
                    localStorage.setItem('supervisorImage', e.target.result);
                    
                    // Add animation to the image container
                    const imageContainer = document.querySelector('.supervisor-image-container');
                    imageContainer.classList.add('animate-bounce-in');
                    
                    // Remove animation after it completes
                    setTimeout(() => {
                        imageContainer.classList.remove('animate-bounce-in');
                    }, 800);
                };
                reader.readAsDataURL(file);
            }
        });

        // Save supervisor name when changed
        document.getElementById('supervisor-name').addEventListener('change', function(event) {
            localStorage.setItem('supervisorName', this.value);
            
            // Add animation to the name input
            this.classList.add('animate-scale-in');
            
            // Remove animation after it completes
            setTimeout(() => {
                this.classList.remove('animate-scale-in');
            }, 500);
        });

        // Load supervisor data from localStorage
        function loadSupervisorData() {
            const savedImage = localStorage.getItem('supervisorImage');
            if (savedImage) {
                document.getElementById('supervisor-image').src = savedImage;
            }
            
            const savedName = localStorage.getItem('supervisorName');
            if (savedName) {
                document.getElementById('supervisor-name').value = savedName;
            }
        }

        // Carousel functionality
        function startCarousel() {
            // Clear any existing interval
            if (carouselInterval) {
                clearInterval(carouselInterval);
            }
            
            // Set initial slide
            showSlide(currentSlide);
            
            // Set up carousel indicators
            const indicators = document.querySelectorAll('.carousel-indicator');
            indicators.forEach(indicator => {
                indicator.addEventListener('click', function() {
                    const slideNumber = parseInt(this.getAttribute('data-slide'));
                    showSlide(slideNumber);
                    resetCarouselInterval();
                });
            });
            
            // Start the interval
            carouselInterval = setInterval(() => {
                currentSlide = currentSlide >= 3 ? 1 : currentSlide + 1;
                showSlide(currentSlide);
            }, CAROUSEL_INTERVAL);
        }

        // Function to show a specific slide
        function showSlide(slideNumber) {
            const slides = document.querySelectorAll('.carousel-slide');
            const indicators = document.querySelectorAll('.carousel-indicator');
            
            // Hide all slides
            slides.forEach(slide => {
                slide.classList.remove('active');
                slide.classList.remove('prev');
            });
            
            // Remove active class from all indicators
            indicators.forEach(indicator => {
                indicator.classList.remove('active');
            });
            
            // Show the selected slide
            const currentSlideElement = document.getElementById(`carousel-slide-${slideNumber}`);
            currentSlideElement.classList.add('active');
            
            // Mark the previous slide
            const prevSlideNumber = slideNumber === 1 ? 3 : slideNumber - 1;
            const prevSlideElement = document.getElementById(`carousel-slide-${prevSlideNumber}`);
            prevSlideElement.classList.add('prev');
            
            // Update the indicator
            indicators[slideNumber - 1].classList.add('active');
            
            // Update current slide variable
            currentSlide = slideNumber;
            
            // Apply animation effect based on slide content
            applyAnimationEffect(currentSlideElement, slideNumber);
        }

        // Function to apply animation effect to slide content
        function applyAnimationEffect(slideElement, slideNumber) {
            // Get the content elements
            const contentElements = slideElement.querySelectorAll('.carousel-content > *');
            
            // Remove any existing animation classes
            contentElements.forEach(element => {
                ANIMATION_EFFECTS.forEach(effect => {
                    element.classList.remove(effect);
                });
            });
            
            // Apply new animation with delay
            contentElements.forEach((element, index) => {
                setTimeout(() => {
                    // Use different animation effect based on slide number
                    const effectIndex = (slideNumber - 1) % ANIMATION_EFFECTS.length;
                    element.classList.add(ANIMATION_EFFECTS[effectIndex]);
                }, index * 100);
            });
        }

        // Function to reset the carousel interval
        function resetCarouselInterval() {
            if (carouselInterval) {
                clearInterval(carouselInterval);
            }
            
            carouselInterval = setInterval(() => {
                currentSlide = currentSlide >= 3 ? 1 : currentSlide + 1;
                showSlide(currentSlide);
            }, CAROUSEL_INTERVAL);
        }

        // Initialize the dashboard
        function init() {
            loadAllData();
            setupAutoRefresh();
            loadSupervisorData();
        }

        // Start the dashboard
        init();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'966a671463ecde58',t:'MTc1Mzc2ODg5Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
