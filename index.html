<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construction Operations Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            text-align: center;
        }
        
        .header h1 {
            color: #2d3748;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #718096;
            font-size: 1.1rem;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .metric-label {
            color: #718096;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .erection { color: #48bb78; }
        .dismantling { color: #ed8936; }
        .productivity { color: #667eea; }
        .manpower { color: #9f7aea; }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .data-table {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .table-header {
            background: #4a5568;
            color: white;
            padding: 20px 25px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .table-content {
            max-height: 400px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .erection-badge {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .dismantling-badge {
            background: #fed7aa;
            color: #9c4221;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #718096;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>Construction Operations Dashboard</h1>
            <p>Real-time monitoring of DPR, Manpower & Productivity</p>
            <div style="margin-top: 15px; display: flex; justify-content: center; align-items: center; gap: 20px;">
                <button id="refreshBtn" onclick="loadAllData()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                    üîÑ Refresh Data
                </button>
                <div id="loadingIndicator" style="display: none; color: #667eea; font-weight: 600;">
                    ‚è≥ Loading data...
                </div>
                <div id="lastRefresh" style="color: #718096; font-size: 0.9rem;">
                    Last updated: Never
                </div>
                <div id="autoRefreshStatus" style="color: #48bb78; font-size: 0.9rem; font-weight: 600;">
                    üü¢ Auto-refresh: ON (Every hour)
                </div>
            </div>
        </div>
        
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value erection">153.25</div>
                <div class="metric-label">Total Erection Volume</div>
            </div>
            <div class="metric-card">
                <div class="metric-value dismantling">293.7</div>
                <div class="metric-label">Total Dismantling Volume</div>
            </div>
            <div class="metric-card">
                <div class="metric-value productivity">2.1</div>
                <div class="metric-label">Productivity Rate</div>
            </div>
            <div class="metric-card">
                <div class="metric-value manpower">144</div>
                <div class="metric-label">Total Manhours</div>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('overview')">Overview</div>
            <div class="tab" onclick="showTab('allover')">All Over</div>
            <div class="tab" onclick="showTab('dpr')">DPR Details</div>
            <div class="tab" onclick="showTab('manpower')">Manpower</div>
            <div class="tab" onclick="showTab('productivity')">Productivity</div>
        </div>
        
        <div id="overview" class="tab-content active">
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-title">Work Type Distribution</div>
                    <canvas id="workTypeChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Daily Volume Trend</div>
                    <canvas id="volumeTrendChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Supervisor Performance</div>
                    <canvas id="supervisorChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Manhours Distribution</div>
                    <canvas id="manhoursChart"></canvas>
                </div>
            </div>
        </div>
        
        <div id="allover" class="tab-content">
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-title">Target vs Achievement Trend</div>
                    <canvas id="targetAchievementChart"></canvas>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Daily Performance Overview</div>
                    <canvas id="dailyPerformanceChart"></canvas>
                </div>
            </div>
            <div class="data-table">
                <div class="table-header">All Over Performance Data</div>
                <div class="table-content">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Erection</th>
                                <th>Dismantling</th>
                                <th>Total Manhours</th>
                                <th>Target</th>
                                <th>Achieved</th>
                                <th>Achievement %</th>
                            </tr>
                        </thead>
                        <tbody id="alloverTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div id="dpr" class="tab-content">
            <div class="data-table">
                <div class="table-header">Daily Progress Report (DPR)</div>
                <div class="table-content">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Supervisor</th>
                                <th>Work Type</th>
                                <th>Dimensions (L√óW√óH)</th>
                                <th>Qty</th>
                                <th>Volume</th>
                                <th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody id="dprTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div id="manpower" class="tab-content">
            <div class="data-table">
                <div class="table-header">Manpower Allocation</div>
                <div class="table-content">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Supervisor</th>
                                <th>Employee Name</th>
                                <th>OT Hours</th>
                                <th>Total Manhours</th>
                            </tr>
                        </thead>
                        <tbody id="manpowerTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div id="productivity" class="tab-content">
            <div class="data-table">
                <div class="table-header">Productivity Analysis</div>
                <div class="table-content">
                    <table>
                        <thead>
                            <tr>
                                <th>Supervisor Name</th>
                                <th>Erection</th>
                                <th>Dismantling</th>
                                <th>Equivalent</th>
                                <th>Total Manhours</th>
                                <th>Productivity</th>
                            </tr>
                        </thead>
                        <tbody id="productivityTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration - Replace with your Google Sheets URLs
        const GOOGLE_SHEETS_CONFIG = {
            DPR_SHEET_URL: 'YOUR_DPR_SHEET_URL_HERE',
            MANPOWER_SHEET_URL: 'YOUR_MANPOWER_SHEET_URL_HERE', 
            PRODUCTIVITY_SHEET_URL: 'YOUR_PRODUCTIVITY_SHEET_URL_HERE',
            ALLOVER_SHEET_URL: 'YOUR_ALLOVER_SHEET_URL_HERE'
        };

        // Data storage
        let dprData = [];
        let manpowerData = [];
        let productivityData = [];
        let allOverData = [];
        let charts = {};

        // Sample fallback data (will be replaced by Google Sheets data)
        const sampleDprData = [
            {date: '2025-07-28', supervisor: 'MAHENDRA KUMAR', workType: 'DISMANTLING', length: 4.5, width: 2.8, height: 2, qty: 1, volume: 25.2, remarks: 'DISMANTLING: 25.2'},
            {date: '2025-07-28', supervisor: 'MAHENDRA KUMAR', workType: 'ERECTION', length: 6, width: 2, height: 5, qty: 1, volume: 60, remarks: 'ERECTION: 60'}
        ];

        const sampleManpowerData = [
            {date: '2025-07-28', supervisor: 'MAHENDRA KUMAR', empName: 'Deepak Das', otHours: 0, totalManhours: 8},
            {date: '2025-07-28', supervisor: 'MAHENDRA KUMAR', empName: 'Niraj', otHours: 0, totalManhours: 8}
        ];

        const sampleProductivityData = [
            {supName: 'MAHENDRA KUMAR', erection: 153.25, dismantling: 293.7, equivalent: 300.1, totalManhours: 144.0, productivity: 2.1}
        ];

        const sampleAllOverData = [
            {date: '28-07-2025', erection: 153.25, dismantling: 293.7, totalManhours: 88, target: 281.6, achieved: 446.95},
            {date: '29-07-2025', erection: 0, dismantling: 0, totalManhours: 64, target: 204.8, achieved: 0}
        ];

        // Google Sheets data fetching functions
        async function fetchGoogleSheetData(url) {
            try {
                const response = await fetch(url);
                const text = await response.text();
                return parseCSVData(text);
            } catch (error) {
                console.error('Error fetching Google Sheets data:', error);
                return null;
            }
        }

        function parseCSVData(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',').map(v => v.trim());
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    data.push(row);
                }
            }
            return data;
        }

        async function loadAllData() {
            showLoadingIndicator();
            
            try {
                // Fetch data from Google Sheets
                const [dprResult, manpowerResult, productivityResult, allOverResult] = await Promise.all([
                    fetchGoogleSheetData(https://docs.google.com/spreadsheets/d/e/2PACX-1vR770AQ-HHixlcLynNRlnX01iKGuoWbQjYKL4HuVkL6dkiQlneLSmavh0ol0qfNln4UTN20ZXIQ8yuY/pub?gid=0&single=true&output=csv),
                    fetchGoogleSheetData(https://docs.google.com/spreadsheets/d/e/2PACX-1vR770AQ-HHixlcLynNRlnX01iKGuoWbQjYKL4HuVkL6dkiQlneLSmavh0ol0qfNln4UTN20ZXIQ8yuY/pub?gid=1128347685&single=true&output=csv),
                    fetchGoogleSheetData(https://docs.google.com/spreadsheets/d/e/2PACX-1vR770AQ-HHixlcLynNRlnX01iKGuoWbQjYKL4HuVkL6dkiQlneLSmavh0ol0qfNln4UTN20ZXIQ8yuY/pub?gid=67021281&single=true&output=csv),
                    fetchGoogleSheetData(https://docs.google.com/spreadsheets/d/e/2PACX-1vR770AQ-HHixlcLynNRlnX01iKGuoWbQjYKL4HuVkL6dkiQlneLSmavh0ol0qfNln4UTN20ZXIQ8yuY/pub?gid=834519060&single=true&output=csv)
                ]);

                // Use fetched data or fallback to sample data
                dprData = dprResult || sampleDprData;
                manpowerData = manpowerResult || sampleManpowerData;
                productivityData = productivityResult || sampleProductivityData;
                allOverData = allOverResult || sampleAllOverData;

                // Update dashboard
                updateMetrics();
                populateAllTables();
                updateAllCharts();
                
                updateLastRefreshTime();
                hideLoadingIndicator();
                
            } catch (error) {
                console.error('Error loading data:', error);
                // Use sample data as fallback
                dprData = sampleDprData;
                manpowerData = sampleManpowerData;
                productivityData = sampleProductivityData;
                allOverData = sampleAllOverData;
                
                populateAllTables();
                updateAllCharts();
                hideLoadingIndicator();
            }
        }

        function showLoadingIndicator() {
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) indicator.style.display = 'block';
        }

        function hideLoadingIndicator() {
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) indicator.style.display = 'none';
        }

        function updateLastRefreshTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            const refreshElement = document.getElementById('lastRefresh');
            if (refreshElement) {
                refreshElement.textContent = `Last updated: ${timeString}`;
            }
        }

        // Tab functionality
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Update metrics
        function updateMetrics() {
            const erectionTotal = dprData.filter(d => d.workType === 'ERECTION').reduce((sum, d) => sum + parseFloat(d.volume || 0), 0);
            const dismantlingTotal = dprData.filter(d => d.workType === 'DISMANTLING').reduce((sum, d) => sum + parseFloat(d.volume || 0), 0);
            const totalManhours = manpowerData.reduce((sum, d) => sum + parseFloat(d.totalManhours || 0), 0);
            const avgProductivity = productivityData.filter(p => p.productivity !== 'N/A' && p.productivity > 0)
                .reduce((sum, p, _, arr) => sum + parseFloat(p.productivity || 0) / arr.length, 0);

            document.querySelector('.erection .metric-value').textContent = erectionTotal.toFixed(2);
            document.querySelector('.dismantling .metric-value').textContent = dismantlingTotal.toFixed(2);
            document.querySelector('.productivity .metric-value').textContent = avgProductivity.toFixed(1);
            document.querySelector('.manpower .metric-value').textContent = totalManhours;
        }

        // Populate tables
        function populateDPRTable() {
            const tbody = document.getElementById('dprTableBody');
            tbody.innerHTML = '';
            
            dprData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.date || ''}</td>
                    <td>${row.supervisor || ''}</td>
                    <td><span class="status-badge ${(row.workType || '').toLowerCase()}-badge">${row.workType || ''}</span></td>
                    <td>${row.length || ''}√ó${row.width || ''}√ó${row.height || ''}</td>
                    <td>${row.qty || ''}</td>
                    <td>${row.volume || ''}</td>
                    <td>${row.remarks || ''}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function populateManpowerTable() {
            const tbody = document.getElementById('manpowerTableBody');
            tbody.innerHTML = '';
            
            manpowerData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.date || ''}</td>
                    <td>${row.supervisor || ''}</td>
                    <td>${row.empName || ''}</td>
                    <td>${row.otHours || ''}</td>
                    <td>${row.totalManhours || ''}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function populateProductivityTable() {
            const tbody = document.getElementById('productivityTableBody');
            tbody.innerHTML = '';
            
            productivityData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.supName || ''}</td>
                    <td>${row.erection || ''}</td>
                    <td>${row.dismantling || ''}</td>
                    <td>${row.equivalent || ''}</td>
                    <td>${row.totalManhours || ''}</td>
                    <td>${row.productivity || ''}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function populateAllOverTable() {
            const tbody = document.getElementById('alloverTableBody');
            tbody.innerHTML = '';
            
            allOverData.forEach(row => {
                const target = parseFloat(row.target || 0);
                const achieved = parseFloat(row.achieved || 0);
                const achievementPercent = target > 0 ? ((achieved / target) * 100).toFixed(1) : '0.0';
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.date || ''}</td>
                    <td>${row.erection || ''}</td>
                    <td>${row.dismantling || ''}</td>
                    <td>${row.totalManhours || ''}</td>
                    <td>${row.target || ''}</td>
                    <td>${row.achieved || ''}</td>
                    <td>${achievementPercent}%</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function populateAllTables() {
            populateDPRTable();
            populateManpowerTable();
            populateProductivityTable();
            populateAllOverTable();
        }

        // Create and update charts
        function createCharts() {
            createWorkTypeChart();
            createVolumeTrendChart();
            createSupervisorChart();
            createManhoursChart();
            createTargetAchievementChart();
            createDailyPerformanceChart();
        }

        function createWorkTypeChart() {
            const ctx = document.getElementById('workTypeChart').getContext('2d');
            const erectionTotal = dprData.filter(d => d.workType === 'ERECTION').reduce((sum, d) => sum + parseFloat(d.volume || 0), 0);
            const dismantlingTotal = dprData.filter(d => d.workType === 'DISMANTLING').reduce((sum, d) => sum + parseFloat(d.volume || 0), 0);
            
            if (charts.workType) charts.workType.destroy();
            charts.workType = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Erection', 'Dismantling'],
                    datasets: [{
                        data: [erectionTotal, dismantlingTotal],
                        backgroundColor: ['#48bb78', '#ed8936'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createVolumeTrendChart() {
            const ctx = document.getElementById('volumeTrendChart').getContext('2d');
            const dateGroups = {};
            
            dprData.forEach(d => {
                if (!dateGroups[d.date]) {
                    dateGroups[d.date] = { erection: 0, dismantling: 0 };
                }
                if (d.workType === 'ERECTION') {
                    dateGroups[d.date].erection += parseFloat(d.volume || 0);
                } else if (d.workType === 'DISMANTLING') {
                    dateGroups[d.date].dismantling += parseFloat(d.volume || 0);
                }
            });

            const dates = Object.keys(dateGroups).sort();
            
            if (charts.volumeTrend) charts.volumeTrend.destroy();
            charts.volumeTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Erection',
                        data: dates.map(d => dateGroups[d].erection),
                        borderColor: '#48bb78',
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Dismantling',
                        data: dates.map(d => dateGroups[d].dismantling),
                        borderColor: '#ed8936',
                        backgroundColor: 'rgba(237, 137, 54, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createSupervisorChart() {
            const ctx = document.getElementById('supervisorChart').getContext('2d');
            const activeSupervisors = productivityData.filter(p => p.productivity !== 'N/A' && parseFloat(p.productivity || 0) > 0);
            
            if (charts.supervisor) charts.supervisor.destroy();
            charts.supervisor = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: activeSupervisors.map(p => (p.supName || '').split(' ')[0]),
                    datasets: [{
                        label: 'Productivity',
                        data: activeSupervisors.map(p => parseFloat(p.productivity || 0)),
                        backgroundColor: '#667eea',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createManhoursChart() {
            const ctx = document.getElementById('manhoursChart').getContext('2d');
            const dateGroups = {};
            manpowerData.forEach(m => {
                if (!dateGroups[m.date]) dateGroups[m.date] = 0;
                dateGroups[m.date] += parseFloat(m.totalManhours || 0);
            });
            
            if (charts.manhours) charts.manhours.destroy();
            charts.manhours = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(dateGroups),
                    datasets: [{
                        label: 'Total Manhours',
                        data: Object.values(dateGroups),
                        backgroundColor: '#9f7aea',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createTargetAchievementChart() {
            const ctx = document.getElementById('targetAchievementChart').getContext('2d');
            const activeData = allOverData.filter(d => parseFloat(d.target || 0) > 0 || parseFloat(d.achieved || 0) > 0);
            
            if (charts.targetAchievement) charts.targetAchievement.destroy();
            charts.targetAchievement = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: activeData.map(d => (d.date || '').substring(0, 5)),
                    datasets: [{
                        label: 'Target',
                        data: activeData.map(d => parseFloat(d.target || 0)),
                        borderColor: '#f56565',
                        backgroundColor: 'rgba(245, 101, 101, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Achieved',
                        data: activeData.map(d => parseFloat(d.achieved || 0)),
                        borderColor: '#48bb78',
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createDailyPerformanceChart() {
            const ctx = document.getElementById('dailyPerformanceChart').getContext('2d');
            const activeData = allOverData.filter(d => parseFloat(d.target || 0) > 0 || parseFloat(d.achieved || 0) > 0);
            
            if (charts.dailyPerformance) charts.dailyPerformance.destroy();
            charts.dailyPerformance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: activeData.map(d => (d.date || '').substring(0, 5)),
                    datasets: [{
                        label: 'Erection',
                        data: activeData.map(d => parseFloat(d.erection || 0)),
                        backgroundColor: '#48bb78',
                        borderRadius: 4
                    }, {
                        label: 'Dismantling',
                        data: activeData.map(d => parseFloat(d.dismantling || 0)),
                        backgroundColor: '#ed8936',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateAllCharts() {
            createCharts();
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial data
            loadAllData();
            
            // Set up auto-refresh every hour (3600000 milliseconds)
            setInterval(loadAllData, 3600000);
            
            // Also refresh every 5 minutes for testing (remove this in production)
            // setInterval(loadAllData, 300000);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9669f342c3d085c9',t:'MTc1Mzc2NDE1My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
